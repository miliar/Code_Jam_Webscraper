#SPOJ-bot v0.1 by Tjandra Satria Gunawan#<a href="http://tjandra-king-of-math.blogspot.com/">My Blog</a> or <a href="http://tjsplit.blogspot.com/">My App</a>from urllib import request as Rqfrom urllib import parse as Psfrom http import cookiejar as Ckimport mimetypesimport getpassREQU=0CARE='ISO-8859-1'jenhur='\'times new roman\', times'tubu=Rq.HTTPCookieProcessor(Ck.CookieJar())opnr=Rq.build_opener(tubu)catg=["Hidden","Classical","Challenge","Tutorial","Partial","Riddle"]mon=["","January","February","March","April","May","June","July","August","September","October","November","December"]def buka(sit,data=None,hdr=[]):	global REQU	opnr=Rq.build_opener(tubu)	i=len(hdr)	#opnr.addheaders=[('user-agent','Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; Trident/6.0)')]	while i:		i-=1		opnr.addheaders.append((hdr[i][0],hdr[i][1]))	while 1:		try:			REQU+=1			ret=opnr.open(sit,data).read()			break		except:print("Connection reset, reconnecting...")	return retdef LNK(addr,trgt="",ttle=""):	ret="<a href=\""+addr+"\""	if len(trgt):ret+=" target=\""+trgt+"\""	if len(ttle):ret+=" title=\""+ttle+"\""	ret+=">"	return retdef COL(wrn):	return "<span style=\"color:"+wrn+";\">"def PAR(align="",size="",decor="",lbl="",color=""):	ret="<p style=\"font-family: "+jenhur+";"	if len(align):ret+="text-align: "+align+";"	if len(size):ret+="font-size: "+size+";"	if len(decor):ret+="text-decoration: "+decor+";"	if len(color):ret+="color:"+color+";"	ret+="\""	if len(lbl):ret+=" id=\""+lbl+"\""	ret+=">"	return retdef get_solver(code):	#format: [problem name,best solver login,best solver name,best solver time,	#			sec solver login, sec solver name, sec solver time]	ret=[]	pp=buka('http://www.spoj.com/ranks/'+code+'/')	i=pp.find(("/problems/"+code).encode(CARE))	i+=pp[i:].find(b'\">')+2	j=i+pp[i:].find(b'</a>')	ret.append(pp[i:j].decode(CARE))	i=pp.find(b'<tr class=\"kol')	if i!=-1:		i+=pp[i:].find(b'/users/')+7		j=i+pp[i:].find(b'/')		ret.append(pp[i:j].decode(CARE))		i+=pp[i:].find(b'>')+1		j=i+pp[i:].find(b'<')		ret.append(pp[i:j].decode(CARE))		i+=pp[i:].find(b'-->')+3		j=i+pp[i:].find(b'<!--')		while pp[i]==b'\t':i+=1		while pp[j-1]==b'\t':j-=1		ret.append(float(pp[i:j].decode(CARE)))		while 1:			k=pp[i:].find(b'<tr class=\"kol')			if k!=-1:				i+=k				i+=pp[i:].find(b'/users/')+7				j=i+pp[i:].find(b'/')				eX=pp[i:j].decode(CARE)				if eX==ret[1]:continue				ret.append(eX)				i+=pp[i:].find(b'>')+1				j=i+pp[i:].find(b'<')				ret.append(pp[i:j].decode(CARE))				i+=pp[i:].find(b'-->')+3				j=i+pp[i:].find(b'<!--')				while pp[i]==b'\t':i+=1				while pp[j-1]==b'\t':j-=1				ret.append(float(pp[i:j].decode(CARE)))				break			else:				ret.append("")				ret.append("")				ret.append(1000.0)				break	else:		ret.append("")		ret.append("")		ret.append(-1.0)		ret.append("")		ret.append("")		ret.append(1000.0)	return retdef get_info(code):	#format: [(0=hidden;1=classical;2=challenge;3=tutorial;4=partial;5=riddle),(year*1000+month*40+day)],BF?]	ret=[]	pp=buka('http://www.spoj.com/problems/'+code+'/')	if pp.find(b'h_problem_hidden')!=-1:ret.append(0)	else:		i=pp.find(b'SPOJ Problem Set (')+18		pq=pp[i:i+2].decode(CARE)		if pq[1]=='l':ret.append(1)		elif pq[1]=='h':ret.append(2)		elif pq[1]=='u':ret.append(3)		elif pq[1]=='a':ret.append(4)		elif pq[1]=='i':ret.append(5)		else:ret.append(0)	i=pp.find(b'Date:</td>')	i+=pp[i:].find(b'<td>')+4	j=i+pp[i:].find(b'</td>')	pq=pp[i:j].decode(CARE)	a,b,c=map(int,pq.split('-'))	ret.append(1000*a+40*b+c)	ret.append(pp.find(b'Languages:</td><td>BF'))	return retdef EDIT(pcode,phtml,EB=0):	if EB:pls="body/"	else:pls="/complete/"	form={'body':phtml}	fdata=Ps.urlencode(form)	buka('http://www.spoj.com/problems/'+pcode+'/edit'+pls,fdata.encode(CARE))	returndef upload(judul,fname):	bond=b'RRRwkwkATWSSGNwkwkRRR'	NL=b'\r\n'	val=open(fname,"rb").read()	fdata=b''	fdata+=b'--'+bond+NL	fdata+=b'Content-Disposition: form-data; name=\"title\"'+NL+NL+judul.encode(CARE)+NL	fdata+=b'--'+bond+NL	fdata+=b'Content-Disposition: form-data; name=\"file_content\"; filename=\"'	fdata+=fname.encode(CARE)+b'\"'+NL+b'Content-Type: '	fdata+=(mimetypes.guess_type(fname)[0] or 'application/octet-stream').encode(CARE)	print(fdata)	fdata+=NL+NL+val+NL+b'--'+bond+b'--'+NL+NL	print(fdata[-100:])	hdr=[['Content-Length',str(len(fdata))],	['Content-Type','multipart/form-data; boundary='+bond.decode(CARE)]]	print(hdr)	buka('http://www.spoj.com/uploads/',fdata,hdr)	returnwhile 1:	user=input("User Name: ")	pswd=getpass.getpass("Password: ")	form={'login_user':user,'password':pswd}	data=Ps.urlencode(form)	html=buka('http://www.spoj.com/myaccount/',data.encode(CARE))	if html.find(b'logout')!=-1:break	print("login failed, please try again")i=html.find(b'<H3> ')j=html[i:].find(b'\'s user data </H3>')+inama=html[i+5:j].decode(CARE)print("Welcome: \""+nama+"\" what do you want now?")print("1) Download your submission")print("2) Build your own problem page list")print("3) Download all (accepted submissions to your own problem)")print("4) Download comments on SPOJ on some specific ID range")print("5) Detect recent change to cube cluster from pyramid")print("6) Scan all SPOJ problem for broken link")print("0) Other trial function (for debug purposes)")print("otherwise) Quit")ch=int(input("Your Choice: "))if ch==0:#	upload("TEST123.jpg","tinggi.jpg")#	buka('http://www.spoj.com/uploads/',b'title=TEST123.jpg&content=tinggi.jpg')	buka('http://www.spoj.com/uploads/',b'Content-Type: multipart/form-data; boundary=RRRwkwkATWSSGNwkwkRRR\n\n--RRRwkwkATWSSGNwkwkRRR\nContent-Disposition: form-data; name=\"title\"\n\nWKWK.txt\n--RRRwkwkATWSSGNwkwkRRR\nContent-Disposition: form-data; name=\"file_content\"; filename=\"WKWK.txt\"\nContent-Type: text/plain\n\nMbrr, dingin sekali di sini..\n--RRRwkwkATWSSGNwkwkRRR--\n')elif ch==1:	while 1:		print("Files will be saved in the same directory as this python file")		print("Options:")		print("1) Download all your submission")		print("2) Download Accepted submission only")		ch=int(input("Your Choice: "))		if ch==1 or ch==2:break		print("invalid choice, please try again")	sgnl=buka('http://www.spoj.com/status/'+user+'/signedlist/').split(b'\n')	j,i=len(sgnl)-1,-1	timpa=lewati=0	while i<j:		i+=1		S=sgnl[i].decode(CARE).split('|')		if len(S)!=9:continue		try:ID=int(S[1])		except:continue		S[4]=S[4].replace("?","X")		fn=S[1]+"_"+S[2].replace(":","-")+"_"+S[3]+"_"+S[4]+"_"+S[5]+"_"+S[6]+"_"+S[7]+".html"		print("saving file: \""+fn+"\" signed list line",i,"of",j)		if ord(S[4][9])!=ord('C') and (ord(S[4][9])<ord('0') or ord(S[4][9])>ord('9')) and ch==2:continue		if timpa==0:			try:				f=open(fn,'rb')				k=1;f.close()			except:k=0			if k:				if lewati:continue				print("file already exist, what do you want now?")				print("1) Overwrite this file with new one")				print("2) Continue to next file")				print("3) Overwrite all file with new one")				print("4) Always continue to next file")				print("otherwise) Stop downloading data")				k=int(input("your choice: "))				if k>4 or k<1:k=2;i=j				if k==4:k=2;lewati=1				if k==3:timpa=1				if k==2:continue		try:f=open(fn,'wb')		except:f=open(S[1]+"error getting name.html",'wb')		f.write(buka('http://www.spoj.com/files/src/'+S[1].replace(' ','')+'/'))		f.close()elif ch==2:	print("See: http://www.spoj.com/problems/TJANDRA for example")	print("getting data...")	brw=buka('http://www.spoj.com/myaccount/edit/')	i=brw.find(b'<div class=\"time\">')+18	i+=brw[i:].find(b'<div class=\"time\">\n')+19	j=brw[i:].find(b'\n')+i	sdate=brw[i:j].decode(CARE)	i=brw[j:].find(b'<b>')+j+3	j=brw[i:].find(b'</b>')+i	stime=brw[i:j].decode(CARE).replace(" : ",":")	print("server time:",sdate,stime)	i=brw.find(b'<input name=\"email\"')	i+=brw[i:].find(b'value=\"')+7	j=brw[i:].find(b'\"')+i	emil=brw[i:j].decode(CARE)	print("Your email:",emil)	dua=user[0:1].upper()+user[1:2]	out="";col="</span>"	STRG="<strong>";strg="</strong>"	EM="<em>";em="</em>";sp="&nbsp;"	par="</p>";hr="<hr />";lnk="</a>"	BQ="<blockquote>";bq="</blockquote>"	out=""	out+=PAR("center","","underline")+STRG+"Last update: "+strg+sdate+sp+stime+" SPOJ time."+par+"\n"+hr+"\n"	out+=PAR()+STRG+"This page contains:"+strg+par+"\n"	out+=PAR()+"1) "+LNK("#"+dua+"Prob")+"List of problem added by "+nama+" to SPOJ"+lnk+par+"\n"	out+=PAR()+"2) "+LNK("#"+dua+"Reco")+"My Record (as Best solver or Runner-up)"+lnk+par+"\n"	out+=PAR()+"3) "+LNK("#"+dua+"Brfu")+"Solved problems by "+nama+" using Brainf**k"+lnk+par+"\n"	out+=PAR()+"4) "+LNK("#"+dua+"Abot")+"About me: "+nama+lnk+par+"\n"	out+=PAR()+EM+STRG+"Note: "+strg	out+="If you found a broken link or incorrect information, you can contact me via PM or email: "	out+=LNK("mailto:"+emil,"_blank","Mail to "+nama)+emil+lnk+em+par+"\n"+hr+"\n"	brnf=[]	#My own problem:	out+=PAR("center","large","",dua+"Prob")+STRG+"List of problem added by "+nama+" to SPOJ"+strg+par+"\n"	print("checking if you're problem setter...")	owp=[[],[],[],[],[],[]]	if brw.find(b'/problems/my\">problem')!=-1:		lolo,lele=-50,50		print("you are problem setter!")		print("parsing html file...")		daft=[]		while lele:			lolo+=50			lele=i=0			print('Opening: '+'http://www.spoj.com/problems/my/start='+str(lolo)+'/')			brw=buka('http://www.spoj.com/problems/my/start='+str(lolo)+'/')			while 1:				k=brw[i:].find(b'/submit/')+8				if k<8:break				lele+=1				i+=k				j=brw[i:].find(b'\"')+i				code=brw[i:j].decode(CARE)				k=len(daft)				hoke=0				while k:					k-=1					if daft[k]==code:						hoke=1						break				if hoke:					lele=0					break				daft.append(code)				ret=get_info(code)				inf=[code]				inf+=[ret[1]]				inf+=get_solver(code)				if ret[2]!=-1:brnf.append([inf[2],code])				owp[ret[0]].append(inf)				print(code,catg[ret[0]],"\""+inf[2]+"\"",ret[1]%1000%40,mon[ret[1]%1000//40],ret[1]//1000)	else:print("unfortunately you\'re not problem setter")	i,j=0,len(owp)-1	while i<j:		i+=1		out+=PAR()+STRG+catg[i]+" Problem:"+strg+par+"\n"		k=l=len(owp[i])		if l==0:out+=PAR()+"Empty."+par+"\n"		while k:			k-=1			inf=owp[i][k]			out+=PAR()+str(k+1)+") "+LNK("../"+inf[0]+"/","_blank",inf[0])+inf[2]+lnk			out+=" (Date Added: "+str(inf[1]%1000%40)+" "+mon[inf[1]%1000//40]+" "+str(inf[1]//1000)+")"			out+=par+"\n"+BQ+"\n"+PAR()			if len(inf[3]):				out+="Congratulations to "+LNK("../../../users/"+inf[3]+"/","_blank",inf[3])				out+=STRG+inf[4]+strg+lnk+" as the "+LNK("../../../ranks/"+inf[0]+"/","_blank")				out+="best solver"+lnk+"."+par				if len(inf[6]):					out+="\n"+PAR()+"Congratulations to "+LNK("../../../users/"+inf[6]+"/","_blank",inf[6])					out+=STRG+inf[7]+strg+lnk+" as the runner-up."+par			else:out+="No solver yet."+par			out+="\n"+bq+"\n"	out+=PAR()+EM+STRG+"Note:"+strg+" Be patient if you become the best or runner-up on my problem and not listed, "	out+="this page updates every week."+em+par+"\n"+hr+"\n"	#My Record:	print("checking for your record...")	out+=PAR("center","large","",dua+"Reco")+STRG+"My Record (as Best Solver or runner-up)"+strg+par+"\n"	brw=buka('http://www.spoj.com/users/'+user+'/')	n=brw.find(b'lightrow')	n+=brw[n:].find(b'<b>')+3	m=brw[n:].find(b'</b>')+n	num=int(brw[n:m].decode(CARE))	cnt=0	fi=brw.find(b'TODO l')	i=st=brw.find(b'List of s')	best=[]	rnup=[]	print("you have",num,"problem solved!")	while 1:		k=brw[i:].find(b'/\">')+3;i+=k		if k<3 or i>fi:break		j=i+brw[i:].find(b'<')		code=brw[i:j].decode(CARE)		if len(code)==0:continue		cnt+=1		print("getting info",cnt,"of",num,"...")		ret=get_solver(code)		if ret[1]==user:			print("you are the best solver on problem "+code+": \""+ret[0]+"\"")			inf=[100.0-100.0*((float(ret[3])+0.001)/(0.001+float(ret[6])))]			inf+=[code]			inf+=ret			best.append(inf)		elif ret[4]==user:			print("you are the runner-up on problem "+code+": \""+ret[0]+"\"")			inf=[100.0-100.0*((float(ret[3])+0.001)/(0.001+float(ret[6])))]			inf+=[code]			inf+=ret			rnup.append(inf)		if cnt==num:break	out+=PAR()+STRG+"As best solver:"+strg+par+"\n"	best.sort(reverse=True)	i,j=0,len(best)	while i<j:		out+=PAR()+str(i+1)+") "+LNK("../"+best[i][1]+"/","_blank",best[i][1])+best[i][2]+lnk+" (Record value: "		out+=LNK("../../../ranks/"+best[i][1]+"/","_blank")+str("%.2f"%best[i][0])+lnk		out+=") |"+COL("green")+" My time: "+str(best[i][5])+"sec"+col		if len(best[i][7]):			out+=" | Best competitor ("			out+=LNK("../../../users/"+best[i][6]+"/","_blank",best[i][6])+best[i][7]+lnk			out+=")\'s time: "+str(best[i][8])+"sec |"+par+"\n"		else:out+=" | "+STRG+"No competitor!"+strg+" |"		i+=1	out+=PAR()+STRG+"As runner-up:"+strg+par+"\n"	rnup.sort()	i,j=0,len(rnup)	while i<j:		out+=PAR()+str(i+1)+") "+LNK("../"+rnup[i][1]+"/","_blank",rnup[i][1])+rnup[i][2]+lnk+" (Record value: "		out+=LNK("../../../ranks/"+rnup[i][1]+"/","_blank")+"-"+str("%.2f"%rnup[i][0])+lnk		out+=") | Best competitor ("		out+=LNK("../../../users/"+rnup[i][3]+"/","_blank",rnup[i][3])+rnup[i][4]+lnk		out+=")\'s time: "+str(rnup[i][5])+" |"+COL("red")+" My time: "+str(rnup[i][8])+"sec"+col+" |"+par+"\n"		i+=1	out+=PAR()+EM+STRG+"Note:"+strg+" Any suggestion to make this page better? message me via PM in forum or email me: "	out+=LNK("mailto:"+emil,"_blank","Mail to "+nama)+emil+lnk+em+par+"\n"+hr+"\n"	#Solved problem using brainf**k by <nama>	out+=PAR("center","large","",dua+"Brfu")+STRG+"Solved problems by "+nama+" using Brainf**k"+strg+par+"\n"	print("Searching solved brainf**k problem...")	brw=buka('http://www.spoj.com/status/'+user+'/signedlist/').split(b'\n')	i,j=-1,len(brw)-1	while i<j:		i+=1		if brw[i].find(b'|  BF |')==-1:continue		S=brw[i].decode(CARE).split('|')		if ord(S[4][9])!=ord('C') and (ord(S[4][9])<ord('0') or ord(S[4][9])>ord('9')):continue		code=S[3].replace(' ','')		k,no=len(brnf),0		while k:			k-=1			if brnf[k][1]==code:no=1;break		if no:continue		print("Detected "+code+", adding to list...")		ret=get_solver(code)		brnf.append([ret[0],code])	brnf.sort()	i,j=0,len(brnf)	while i<j:		out+=PAR()+str(i+1)+") "+LNK("../"+brnf[i][1]+"/","_blank",code)+brnf[i][0]+lnk+par+"\n"		i+=1	out+=PAR()+EM+STRG+"Note:"+strg+" If you want to run your Brainf**k code directly on your computer, you need this "	out+=LNK("http://swapped.cc/#!/bff","_blank","swapped.cc")+"Alex Pankratov"+lnk+"'s bff 1.0.5 interpreter, click "	out+=LNK("https://github.com/apankrat/bff","_blank","bff source")+"here"+lnk	out+=" to download C source code. You can compile it using gcc, then run it on your computer."+em+par+"\n"+hr+"\n"	#About page	out+=PAR("center","large","",dua+"Abot")+STRG+"About Me: "+nama+strg+par+"\n"	out+=PAR()+"Please describe about yourself manually ;-) Edit this HTML using any HTML editor "	out+="(recommended using SPOJ HTML editor when you want to post/edit your problem)"+par	f=open(user+"-page.html",'wb')	f.write(out.encode(CARE))	f.close()	print("html file has been successfully saved with file name: \""+user+"-page.html\"")elif ch==3:	if html.find(b'/problems/my\">problem')==-1:		print("this options for problem setter only")	else:		brw,bi,timpa,lewati=buka('http://www.spoj.com/problems/my/'),0,0,0		while 1:			k=brw[bi:].find(b'/submit/')+8			if k<8:break			bi+=k			j=brw[bi:].find(b'\"')+bi			code=brw[bi:j].decode(CARE)			n=0			while 1:				pp=buka('http://www.spoj.com/ranks/'+code+'/start='+str(n))				i=pp.find(b'class=\"kol')				if i==-1:break				i+=pp[i:].find(b'user=\"')				i+=pp[i:].find(b'\">')+2				while pp[i]<ord('0') or pp[i]>ord('9'):i+=1				j=i+pp[i:].find(b'<')				k=int(pp[i:j].decode(CARE))				if k!=n+1:break				while 1:					k=pp[i:].find(b'/users/')+7					if k<7:break					n+=1;i+=k					j=i+pp[i:].find(b'/')					fn=code+"_"+pp[i:j].decode(CARE)+"_"+str(n)					i+=pp[i:].find(b'res_')+4					j=i+pp[i:].find(b'\"')					ID=pp[i:j].decode(CARE)					fn=fn+"_"+ID+".html"					print("saving file: \""+fn+"\"")					if timpa==0:						try:							f=open(fn,'rb')							k=1;f.close()						except:k=0						if k:							if lewati:continue							print("file already exist, what do you want now?")							print("1) Overwrite this file with new one")							print("2) Continue to next file")							print("3) Overwrite all file with new one")							print("4) Always continue to next file")							print("otherwise) Stop downloading data")							k=int(input("your choice: "))							if k>4 or k<1:k=2;i=j							if k==4:k=2;lewati=1							if k==3:timpa=1							if k==2:continue					try:f=open(fn,'wb')					except:f=open(code+"_error getting name.html",'wb')					while 1:						try:							f.write(buka('http://www.spoj.com/files/src/'+ID+'/'))							break						except:print("Connection reset, reconnecting...")					f.close()elif ch==4:	print("Input comment ID range to download [from to]: ")	x,y=map(int,input().split())	f=open('SPOJ_comment['+str(x)+'...'+str(y)+'].txt','w')	while x<=y:		print("open...")		try:brw=buka('http://www.spoj.com/comment/FRANCKY/edit/'+str(x)+'/')		except:print("-->>>open fail!<<<---")		print("find 0...")		try:i=brw.find(b'<textarea')		except:print("-->>>find 0 fail!<<<---")		print("find find st...")		try:i+=brw[i:].find(b'>')+1		except:print("-->>>find st fail!<<<---")		print("find find end...")		try:j=i+brw[i:].find(b'</textarea>')		except:print("-->>>find end fail!<<<---")		print("decode...")		try:haha=brw[i:j].decode(CARE)		except:print("-->>>decode fail!<<<---")		print("print...")		try:print("[",x,"of",y,"] content:",haha)		except:print("-->>>print fail!<<<---")		print("write str...")		try:f.write('---'+str(x)+'---\n\n')		except:print("-->>>write str fail!<<<---")		print("write haha...")		try:f.write(haha)		except:print("-->>>write haha fail!<<<---")		print("write ent...")		try:f.write('\n')		except:print("-->>>write ent fail!<<<---")		print("flush...")		try:f.flush()		except:print("-->>>flush fail!<<<---")		x+=1	f.close()elif ch==5:	print("this will keep track of all problem using pyramid cluster and notice it")	print("if there is a change from the last check")	#not done yetelif ch==6:	print("thanks francky for the idea")elif ch==7:	print("coming soon!")print("Total HTTP request:",REQU,"Times.")